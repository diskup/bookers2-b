<%= render 'searches/form' %>
<div class='container px-5 px-sm-0'>
  <div class='row'>
    <div class='col-md-3'>
      <h2>User info</h2>
      <%= render 'info', user: @user %>
      <h2 class="mt-3">New book</h2>
      <%= render 'books/form', book: @book %>
    </div>
    <div class='col-md-8 offset-md-1'>
      <h2>Books</h2>
      <%= render 'books/index', books: @books %>

      <h1>投稿数の前日比・前週比</h1>

      <% today_books = @user.books.where('created_at > ?', Date.today).count %>
      <% yesterday_books = @user.books.where(created_at: 1.day.ago.all_day).count %>

      <% if yesterday_books == 0 %>
        <% day_percentage = '???' %>
      <% else %>
        <% day_percentage = today_books * 100 / yesterday_books  %>
      <% end %>

      <% week_books = @user.books.where('created_at > ?', 1.week.ago).count %>
      <% from_week_books = @user.books.where(created_at: [2.week.ago..1.week.ago]).count %>

      <% if from_week_books == 0 %>
        <% week_percentage = '???' %>
      <% else %>
        <% week_percentage = week_books * 100 / from_week_books %>
      <% end %>

      <table class="table table-bordered">
        <tr>
          <th>今日の投稿数</th>
          <th>前日の投稿数</th>
          <th>前日比</th>
        </tr>
        <tr>
          <td><%= today_books %></td>
          <td><%= yesterday_books %></td>
          <% if day_percentage == "???" %>
          <td>計測できません</td>
          <% else %>
          <td><%= day_percentage %>％</td>
          <% end %>
        </tr>
      </table>
      <table class="table table-bordered">
        <tr>
          <th>今週の投稿数</th>
          <th>前週の投稿数</th>
          <th>前週比</th>
        </tr>
        <tr>
          <td><%= week_books %></td>
          <td><%= from_week_books %></td>
          <% if week_percentage == "???" %>
          <td>計測できません</td>
          <% else %>
          <td><%= week_percentage %>％</td>
          <% end %>
        </tr>
      </table>

    </div>
  </div>
</div>